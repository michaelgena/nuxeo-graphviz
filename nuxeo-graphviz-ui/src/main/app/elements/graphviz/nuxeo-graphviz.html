<dom-module id="nuxeo-graphviz" assetpath="nuxeo-graphviz/">
  <template>
  <style>
    paper-button {
      background: #FFFFFF;
      color: black;
    }
    .center {
        text-align: center;
    }
    .left {
        text-align: left;
    }
  </style>
  <nx-connection id="nx"></nx-connection>
  <nuxeo-operation id="GenerateGraph" op="GenerateGraph" params="" response="{{response}}"></nuxeo-operation>

  <div class="bubbleBox">
      <div id="fullscreen" class="bubbleHeader" style="overflow-x:scroll;">
        <paper-button id="fullscreen_button" raised on-tap="_toggleFullScreen">Full Screen</paper-button>
        <table width="100%">
        <tr>
          <td class="center"/>
              <template is="dom-if" if="{{_isDefined(response)}}">
                <img src="{{imgUrl}}" usemap="#G" />
                <div inner-h-t-m-l="{{response}}"></div>
              </template>
              <template is="dom-if" if="{{!_isDefined(response)}}">
                <img src="/nuxeo/img/big_loading.gif" >
              </template>
          </td>
        </tr>
        </tbody>
        </table>
      </div>
  </div>
</template>
<script>
    Polymer({
      is: 'nuxeo-graphviz',
      created: function() {

      },
      properties: {
        params: {
          type:Object,
          value: {}
        },
        imgUrl: {
          type:String,
          value: ''
        },
        isFullScreenMode:  {
          type:Boolean,
          value: false
        }
      },

      ready: function () {
        this.$.GenerateGraph.execute();
        isFullScreenMode = false;
      },

      _refresh: function(){
        this.$.GenerateGraph.execute();
      },
      _isDefined: function(response) {
        if ((typeof response !== 'undefined') && (response !== '') && (response !== null)) {
          this.imgUrl = "/nuxeo/graphviz/img.png?random="+Math.random();
          return true;
        } else {
          return false;
        }
      },
      _toggleFullScreen: function(){
        if(!isFullScreenMode){
          jQuery("#fullscreen").css({"position":"absolute"}).css({"z-index":"100000"}).css({"left":"0px"}).css({"top":"-50px"}).css({"margin-bottom":"-40px"});
          jQuery("#fullscreen_button").html("Close");
          isFullScreenMode = true;
        }else{
          jQuery("#fullscreen").css({"position":""}).css({"z-index":""}).css({"left":""}).css({"top":""}).css({"margin-bottom":""});
          jQuery("#fullscreen_button").html("Full Screen");
          isFullScreenMode = false;
        }
      }
    });
</script>
</dom-module>
